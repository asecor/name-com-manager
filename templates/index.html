<!DOCTYPE html>
<html>
<head>
    <title>Domain Manager</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
</head>
<body class="bg-gray-100">
    {% raw %}
    <div id="app" class="container mx-auto px-4 py-8">
        <div class="flex justify-between items-center mb-8">
            <h1 class="text-3xl font-bold text-gray-800">Domain Manager</h1>
            <a href="/ssl" class="bg-purple-600 text-white px-4 py-2 rounded hover:bg-purple-700 transition">SSL Monitor â†’</a>
        </div>

        <div class="bg-white p-6 rounded-lg shadow-md mb-8 border-t-4 border-blue-500">
            <h2 class="text-xl font-semibold mb-4">Bulk Actions (DNS)</h2>
            <textarea v-model="bulkDomains" class="w-full border p-3 rounded h-32 mb-4 font-mono text-sm" placeholder="subdomain1&#10;subdomain2"></textarea>
            
            <div class="flex flex-wrap items-end gap-4">
                <div class="w-32">
                    <label class="block text-xs font-bold text-gray-500 uppercase">Type</label>
                    <select v-model="bulkType" class="w-full border p-2 rounded">
                        <option value="A">A Record</option>
                        <option value="CNAME">CNAME</option>
                    </select>
                </div>
                <div class="flex-grow">
                    <label class="block text-xs font-bold text-gray-500 uppercase">IP / Target</label>
                    <input v-model="bulkIp" placeholder="1.2.3.4" class="w-full border p-2 rounded">
                </div>
                <div class="flex gap-2">
                    <button @click="addBulk" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">Add to DNS</button>
                    <button @click="removeBulk" class="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700">Remove from DNS</button>
                    <button @click="bulkDomains = ''" class="bg-gray-200 text-gray-700 px-4 py-2 rounded hover:bg-gray-300">Clear Text</button>
                </div>
            </div>

            <div v-if="bulkMessage" :class="bulkClass" class="mt-4 p-4 rounded text-sm" v-html="bulkMessage"></div>
        </div>

        <div class="bg-white rounded-lg shadow-md overflow-hidden">
            <div class="p-4 bg-gray-50 border-b flex justify-between items-center">
                <h2 class="font-bold text-gray-700">Live DNS Records</h2>
                <button @click="fetchRecords" class="text-sm text-blue-600 hover:underline">Refresh List</button>
            </div>
            <table class="w-full text-left border-collapse">
                <thead>
                    <tr class="bg-gray-100 text-xs uppercase text-gray-600">
                        <th class="p-4">Host</th>
                        <th class="p-4">Type</th>
                        <th class="p-4">Answer</th>
                        <th class="p-4 text-right">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <tr v-for="record in records" :key="record.id" class="border-t hover:bg-gray-50">
                        <td class="p-4"><input v-model="record.host" class="border p-1 rounded w-full"></td>
                        <td class="p-4">
                            <select v-model="record.type" class="border p-1 rounded">
                                <option value="A">A</option>
                                <option value="CNAME">CNAME</option>
                            </select>
                        </td>
                        <td class="p-4"><input v-model="record.answer" class="border p-1 rounded w-full text-sm"></td>
                        <td class="p-4 text-right">
                            <button @click="save(record)" class="text-green-600 font-bold mr-3">Save</button>
                            <button @click="remove(record.id)" class="text-red-600 font-bold">Delete</button>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
    {% endraw %}

    <script>
        const { createApp } = Vue
        createApp({
            data() {
                return {
                    records: [],
                    bulkDomains: '', bulkType: 'A', bulkIp: '',
                    bulkMessage: '', bulkClass: ''
                }
            },
            mounted() { this.fetchRecords() },
            methods: {
                async fetchRecords() {
                    const res = await fetch('/api/records');
                    const data = await res.json();
                    this.records = data.records || [];
                },
                async addBulk() {
                    const domains = this.bulkDomains.split(/[\n,]+/).map(d => d.trim()).filter(d => d);
                    const res = await fetch('/api/records/bulk', {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({ domains, ip_address: this.bulkIp, type: this.bulkType })
                    });
                    const data = await res.json();
                    this.bulkMessage = `Added ${data.success.length}. Failed ${data.failed.length}.`;
                    this.bulkClass = 'bg-green-100 text-green-800';
                    this.fetchRecords();
                },
                async removeBulk() {
                    const domains = this.bulkDomains.split(/[\n,]+/).map(d => d.trim()).filter(d => d);
                    if(!confirm(`Delete these ${domains.length} hostnames from DNS?`)) return;
                    const res = await fetch('/api/records/bulk-delete-by-hostname', {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({ domains })
                    });
                    const data = await res.json();
                    this.bulkMessage = `Deleted ${data.success.length}. Errors ${data.failed.length}.`;
                    this.bulkClass = 'bg-red-100 text-red-800';
                    this.fetchRecords();
                },
                async save(r) {
                    await fetch(`/api/records/${r.id}`, {
                        method: 'PUT',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify(r)
                    });
                    alert('Updated');
                },
                async remove(id) {
                    if(confirm('Delete?')) {
                        await fetch(`/api/records/${id}`, { method: 'DELETE' });
                        this.fetchRecords();
                    }
                }
            }
        }).mount('#app')
    </script>
</body>
</html>
