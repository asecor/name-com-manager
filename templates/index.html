<!DOCTYPE html>
<html>
<head>
    <title>Domain Manager</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
</head>
<body class="bg-gray-100">
    {% raw %}
    <div id="app" class="container mx-auto px-4 py-8">
        <div class="flex justify-between items-center mb-8">
            <h1 class="text-3xl font-bold">Domain Manager</h1>
            <a href="/ssl" class="bg-purple-500 text-white px-4 py-2 rounded hover:bg-purple-600">
                SSL Monitor â†’
            </a>
        </div>
        
        <div class="bg-white p-6 rounded-lg shadow-md mb-8">
            <h2 class="text-xl font-semibold mb-4">Bulk Add Domains</h2>
            <div class="mb-4">
                <label class="block text-sm font-medium mb-2">Enter subdomains (one per line):</label>
                <textarea 
                    v-model="bulkDomains" 
                    placeholder="subdomain1&#10;subdomain2"
                    class="w-full border p-2 rounded h-32"
                ></textarea>
            </div>
            <div class="grid grid-cols-3 gap-4 mb-4">
                <div>
                    <label class="block text-sm font-medium mb-2">Record Type:</label>
                    <select v-model="bulkType" class="w-full border p-2 rounded">
                        <option value="A">A Record</option>
                        <option value="CNAME">CNAME</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">IP Address / Target:</label>
                    <input v-model="bulkIp" placeholder="192.168.1.1" class="w-full border p-2 rounded">
                </div>
                <div class="flex items-end">
                    <button @click="addBulkRecords" class="w-full bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
                        Add All Domains
                    </button>
                </div>
            </div>
            
            <div v-if="bulkMessage" class="mt-4 p-4 rounded" :class="bulkMessageClass">
                <div v-html="bulkMessage"></div>
            </div>
        </div>

        <div class="bg-white p-6 rounded-lg shadow-md">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-semibold">DNS Records</h2>
                <div v-if="selectedRecords.length > 0" class="flex gap-2">
                    <input v-model="bulkUpdateIp" placeholder="New IP for selected" class="border p-2 rounded text-sm">
                    <button @click="bulkUpdateSelected" class="bg-orange-500 text-white px-4 py-2 rounded text-sm hover:bg-orange-600">
                        Update {{ selectedRecords.length }} Selected
                    </button>
                </div>
            </div>
            <table class="w-full text-sm">
                <thead>
                    <tr class="border-b bg-gray-50">
                        <th class="p-2 text-left"><input type="checkbox" v-model="selectAll" @change="toggleSelectAll"></th>
                        <th class="p-2 text-left">Host</th>
                        <th class="p-2 text-left">Type</th>
                        <th class="p-2 text-left">Answer</th>
                        <th class="p-2 text-left">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <tr v-for="record in records" :key="record.id" class="border-b hover:bg-gray-50">
                        <td class="p-2"><input type="checkbox" :value="record.id" v-model="selectedRecords"></td>
                        <td class="p-2"><input v-model="record.host" class="border p-1 rounded w-full"></td>
                        <td class="p-2">
                            <select v-model="record.type" class="border p-1 rounded">
                                <option value="A">A</option>
                                <option value="CNAME">CNAME</option>
                            </select>
                        </td>
                        <td class="p-2"><input v-model="record.answer" class="border p-1 rounded w-full"></td>
                        <td class="p-2">
                            <button @click="updateRecord(record)" class="text-green-600 font-bold mr-2">Save</button>
                            <button @click="deleteRecord(record.id)" class="text-red-600 font-bold">Delete</button>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
    {% endraw %}

    <script>
        const { createApp } = Vue
        createApp({
            data() {
                return {
                    records: [],
                    selectedRecords: [],
                    selectAll: false,
                    bulkDomains: '',
                    bulkType: 'A',
                    bulkIp: '',
                    bulkMessage: '',
                    bulkMessageClass: '',
                    bulkUpdateIp: '',
                    newRecord: { host: '', type: 'A', answer: '' }
                }
            },
            mounted() { this.fetchRecords() },
            methods: {
                async fetchRecords() {
                    const res = await fetch('/api/records');
                    const data = await res.json();
                    this.records = data.records || [];
                },
                async addBulkRecords() {
                    const domains = this.bulkDomains.split(/[\n,]+/).map(d => d.trim()).filter(d => d);
                    const response = await fetch('/api/records/bulk', {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({ domains, ip_address: this.bulkIp, type: this.bulkType })
                    });
                    const results = await response.json();
                    this.bulkMessage = `Success: ${results.success.length}, Failed: ${results.failed.length}`;
                    this.bulkMessageClass = results.failed.length > 0 ? 'bg-yellow-100' : 'bg-green-100';
                    this.fetchRecords();
                },
                async updateRecord(record) {
                    await fetch(`/api/records/${record.id}`, {
                        method: 'PUT',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify(record)
                    });
                    alert('Record updated');
                },
                async deleteRecord(id) {
                    if(confirm('Delete?')) {
                        await fetch(`/api/records/${id}`, { method: 'DELETE' });
                        this.fetchRecords();
                    }
                },
                toggleSelectAll() {
                    this.selectedRecords = this.selectAll ? this.records.map(r => r.id) : [];
                },
                async bulkUpdateSelected() {
                    await fetch('/api/records/bulk-update', {
                        method: 'PUT',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({ record_ids: this.selectedRecords, new_ip: this.bulkUpdateIp })
                    });
                    this.selectedRecords = [];
                    this.fetchRecords();
                }
            }
        }).mount('#app')
    </script>
</body>
</html>